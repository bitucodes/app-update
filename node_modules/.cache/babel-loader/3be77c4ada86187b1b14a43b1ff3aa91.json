{"ast":null,"code":"'use strict';\n\nvar BB = require('bluebird');\nvar chownr = BB.promisify(require('chownr'));\nvar mkdirp = BB.promisify(require('mkdirp'));\nvar inflight = require('promise-inflight');\nmodule.exports.chownr = fixOwner;\nfunction fixOwner(filepath, uid, gid) {\n  if (!process.getuid) {\n    // This platform doesn't need ownership fixing\n    return BB.resolve();\n  }\n  if (typeof uid !== 'number' && typeof gid !== 'number') {\n    // There's no permissions override. Nothing to do here.\n    return BB.resolve();\n  }\n  if (typeof uid === 'number' && process.getuid() === uid && typeof gid === 'number' && process.getgid() === gid) {\n    // No need to override if it's already what we used.\n    return BB.resolve();\n  }\n  return inflight('fixOwner: fixing ownership on ' + filepath, function () {\n    return chownr(filepath, typeof uid === 'number' ? uid : process.getuid(), typeof gid === 'number' ? gid : process.getgid()).catch({\n      code: 'ENOENT'\n    }, function () {\n      return null;\n    });\n  });\n}\nmodule.exports.mkdirfix = mkdirfix;\nfunction mkdirfix(p, uid, gid, cb) {\n  return mkdirp(p).then(function (made) {\n    if (made) {\n      return fixOwner(made, uid, gid).then(function () {\n        return made;\n      });\n    }\n  }).catch({\n    code: 'EEXIST'\n  }, function () {\n    // There's a race in mkdirp!\n    return fixOwner(p, uid, gid).then(function () {\n      return null;\n    });\n  });\n}","map":null,"metadata":{},"sourceType":"script"}