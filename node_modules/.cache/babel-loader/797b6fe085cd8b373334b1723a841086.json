{"ast":null,"code":"'use strict';\n\nmodule.exports = function defFunc(ajv) {\n  var transform = {\n    trimLeft: function trimLeft(value) {\n      return value.replace(/^[\\s]+/, '');\n    },\n    trimRight: function trimRight(value) {\n      return value.replace(/[\\s]+$/, '');\n    },\n    trim: function trim(value) {\n      return value.trim();\n    },\n    toLowerCase: function toLowerCase(value) {\n      return value.toLowerCase();\n    },\n    toUpperCase: function toUpperCase(value) {\n      return value.toUpperCase();\n    },\n    toEnumCase: function toEnumCase(value, cfg) {\n      return cfg.hash[makeHashTableKey(value)] || value;\n    }\n  };\n  defFunc.definition = {\n    type: 'string',\n    errors: false,\n    modifying: true,\n    valid: true,\n    compile: function compile(schema, parentSchema) {\n      var cfg;\n      if (schema.indexOf('toEnumCase') !== -1) {\n        // build hash table to enum values\n        cfg = {\n          hash: {}\n        };\n\n        // requires `enum` in schema\n        if (!parentSchema.enum) throw new Error('Missing enum. To use `transform:[\"toEnumCase\"]`, `enum:[...]` is required.');\n        for (var i = parentSchema.enum.length; i--; i) {\n          var v = parentSchema.enum[i];\n          if (typeof v !== 'string') continue;\n          var k = makeHashTableKey(v);\n          // requires all `enum` values have unique keys\n          if (cfg.hash[k]) throw new Error('Invalid enum uniqueness. To use `transform:[\"toEnumCase\"]`, all values must be unique when case insensitive.');\n          cfg.hash[k] = v;\n        }\n      }\n      return function (data, dataPath, object, key) {\n        // skip if value only\n        if (!object) return;\n\n        // apply transform in order provided\n        for (var j = 0, l = schema.length; j < l; j++) {\n          data = transform[schema[j]](data, cfg);\n        }\n        object[key] = data;\n      };\n    },\n    metaSchema: {\n      type: 'array',\n      items: {\n        type: 'string',\n        enum: ['trimLeft', 'trimRight', 'trim', 'toLowerCase', 'toUpperCase', 'toEnumCase']\n      }\n    }\n  };\n  ajv.addKeyword('transform', defFunc.definition);\n  return ajv;\n  function makeHashTableKey(value) {\n    return value.toLowerCase();\n  }\n};","map":null,"metadata":{},"sourceType":"script"}